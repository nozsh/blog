---
draft: false
# url: "" # slug
title: "–†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º Matrix-—á–∞—Ç –¥–æ–º–∞ –∏ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç. Self-hosted –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä"
description: "–†–∞—Å—Å–∫–∞–∂—É –∫–∞–∫ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å Matrix –Ω–∞ –¥–æ–º–∞—à–Ω–µ–º —Å–µ—Ä–≤–µ—Ä–µ –∑–∞ NAT –∏ —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ."
summary: "–†–∞—Å—Å–∫–∞–∂—É –∫–∞–∫ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å Matrix –Ω–∞ –¥–æ–º–∞—à–Ω–µ–º —Å–µ—Ä–≤–µ—Ä–µ –∑–∞ NAT –∏ —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ."
date: 2025-08-10
lastmod: 2026-01-30
categories: ["Long read", "Self-hosted"] # ["cat 1", "cat 2"]
tags: ["Linux", "By AI"] # ['tag 1', 'tag 2']
author: ["nozsh"] # ['Me', 'You'] multiple authors
# authorURL: [""] # ['link author 1', 'link author 2'], ex. ['', 'https://example.com']
# canonicalURL: "yourself"
# CanonicalLinkText: "–ò—Å—Ç–æ—á–Ω–∏–∫:"
# weight: 1
# robotsNoIndex: true

# sha1: "" # for giscus

showToc: true
# TocOpen: false
# hidemeta: true
# comments: false
# disableHLJS: true
# disableShare: true
# hideSummary: true
# hideFooter: true
# searchHidden: true
# ShowCodeCopyButtons: false
# ShowReadingTime: false
# ShowWordCount: false
# hideAuthor: true
# ShowBreadCrumbs: true
# ShowPostNavLinks: false
# ShowRssButtonInSectionTermList: false
# ShowCanonicalLink: true
# UseHugoToc: false
byai: true
cover:
  image: "@img/how-to-set-up-matrix-chat-with-pangolin-cover.webp" # image path/url
  width: "1863" # only for img from url; EX: 1920
  height: "1111" # only for img from url; EX: 1080
  alt: "–†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º Matrix-—á–∞—Ç –¥–æ–º–∞ –∏ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç. Self-hosted –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä - Cover" # alt text
  # caption: "Photo by [Sajad Nori](#?sl) / [Unsplash](https://unsplash.com/?sl)" # display caption under cover
  relative: true # when using page bundles set this to true
  hidden: false # only hide on current single page
---

{{% details/1 "–ò–∑–º–µ–Ω–µ–Ω–∏—è" %}}
- 30 —è–Ω–≤. 2026
  - –î–æ–±–∞–≤–ª–µ–Ω–æ: <a href="#-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–∏-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-sso">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è SSO</a>
- 27 —è–Ω–≤. 2026
  - –î–æ–±–∞–≤–ª–µ–Ω–æ: <a href="#-–∫—Ä–∞—Å–∏–≤—ã–µ-—é–∑–µ—Ä–Ω–µ–π–º—ã">–ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–µ —é–∑–µ—Ä–Ω–µ–π–º—ã</a>
  - –î–æ–±–∞–≤–ª–µ–Ω–æ: <a href="#-–≤–∫–ª—é—á–µ–Ω–∏–µ–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-—Ñ–µ–¥–µ—Ä–∞—Ü–∏–∏">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –≤–∫–ª—é—á–µ–Ω–∏–µ —Ñ–µ–¥–µ—Ä–∞—Ü–∏–∏</a>
  - –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è PostgreSQL v18+
- 13 –∞–≤–≥. 2025
  - –î–æ–±–∞–≤–ª–µ–Ω–æ: <a href="#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-turn-—Å–µ—Ä–≤–µ—Ä–∞-coturn">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ TURN —Å–µ—Ä–≤–µ—Ä–∞ (Coturn)</a>
{{% /details/1 %}}


## –í–≤–µ–¥–µ–Ω–∏–µ

–≠—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–æ –æ —á–µ–º –≤—ã –¥—É–º–∞–µ—Ç–µ. –í–∞–º –Ω–µ –ø—Ä–∏–¥–µ—Ç—Å—è –ø–æ–∫—É–ø–∞—Ç—å –¥–æ—Ä–æ–≥–æ–π VPS –¥–ª—è —Ö–æ—Å—Ç–∏–Ω–≥–∞ [Matrix](https://matrix.org/?sl). –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ–≥–æ VPS –∏ —Å—Ä–µ–¥–Ω–µ-–º–æ—â–Ω–æ–≥–æ –ü–ö –ø—Ä—è–º–æ —É –≤–∞—Å –¥–æ–º–∞.

{{< callout/note >}}
–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ —Å—Ç–∞—Ç—å—è –Ω–∞–ø–∏—Å–∞–Ω–∞ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ Linux (Debian) –∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Docker.
{{< /callout/note >}}

### –û Matrix

Matrix -- —ç—Ç–æ –æ—Ç–∫—Ä—ã—Ç—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –ü—Ä–æ–µ–∫—Ç –±—ã–ª –∑–∞–ø—É—â–µ–Ω –≤ 2014 –≥–æ–¥—É –∫–æ–º–∞–Ω–¥–æ–π –∏–∑ –∫–æ–º–ø–∞–Ω–∏–∏ Amdocs [^thenextweb-1] . –ü—Ä–æ—Ç–æ–∫–æ–ª –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–æ–¥–µ–ª—å —Å–æ–±—ã—Ç–∏–π, —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –∏ API –¥–ª—è –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏, –∞ —Ç–∞–∫–∂–µ –¥–ª—è –∏—Ö —Ñ–µ–¥–µ—Ä–∞—Ü–∏–∏, —Ç–æ –µ—Å—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É —Å–æ–±–æ–π.

–î–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö Matrix –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ HTTP/HTTPS, WebSockets –∏ WebRTC. –°–æ–±—ã—Ç–∏—è –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ REST-–ø–æ–¥–æ–±–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã.

–ì–ª–∞–≤–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å Matrix -- —ç—Ç–æ –µ–≥–æ —Ñ–µ–¥–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –∏ –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ [^thenextweb-1] . –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–µ—Ä–≤–µ—Ä–æ–≤ –º–æ–≥—É—Ç –æ–±—ä–µ–¥–∏–Ω—è—Ç—å—Å—è –≤ –µ–¥–∏–Ω—É—é –æ—Ç–∫—Ä—ã—Ç—É—é —Ñ–µ–¥–µ—Ä–∞—Ü–∏—é, —á—Ç–æ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –æ–¥–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ —É–∑–ª–∞ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≥–∏–±–∫–æ—Å—Ç—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.

Matrix –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–¥–∞—á—É —Ç–µ–∫—Å—Ç–∞, —Ñ–∞–π–ª–æ–≤ –∏ –º–µ–¥–∏–∞, –∞ —Ç–∞–∫–∂–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ [^medevel-1] . –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –æ–±—â–∞—Ç—å—Å—è, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –∏–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.

–î–ª—è –∑–∞—â–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö Matrix –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∫–≤–æ–∑–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ (E2E). –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–π —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ, –∏ —Ç–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–∏ —á–∞—Ç–∞ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –∫–ª—é—á–∞–º–∏ –º–æ–≥—É—Ç –µ–≥–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å. –ü—Ä–∏ —ç—Ç–æ–º —Å–µ—Ä–≤–µ—Ä—ã –≤–∏–¥—è—Ç —Å–ª—É–∂–µ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, —Ç–∞–∫—É—é –∫–∞–∫ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ —Å–æ—Å—Ç–∞–≤ –∫–æ–º–Ω–∞—Ç.

Matrix –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —á–∞—Å—Ç–Ω—ã–º–∏ –ª–∏—Ü–∞–º–∏, —Ç–∞–∫ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏, –≤–∫–ª—é—á–∞—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –∏ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–µ–∫—Ç–æ—Ä. –ù–∞–ø—Ä–∏–º–µ—Ä, —Ä–µ—à–µ–Ω–∏—è –Ω–∞ –±–∞–∑–µ Matrix –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤ –≤–æ–æ—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏–ª–∞—Ö [^element-1] –∏ —Å–∏—Å—Ç–µ–º–µ –∑–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ì–µ—Ä–º–∞–Ω–∏–∏ [^matrix-1] .

[^thenextweb-1]: [What's the Matrix protocol? And how will it change modern messaging?](https://thenextweb.com/news/what-is-matrix-and-how-this-open-source-protocol-wants-to-change-messaging?nt)
[^medevel-1]: [Matrix: a decentralized open-source messaging platform for the future](https://medevel.com/matrix-a-decentralized-open-source-messaging-platform-for-the-future/?nt)
[^element-1]: [A secure messaging app for the German Armed Forces](https://element.io/matrix-in-germany/projects/bwmessenger?sl)
[^matrix-1]: [Germany's national healthcare system adopts Matrix!](https://matrix.org/blog/2021/07/21/germany-s-national-healthcare-system-adopts-matrix/?sl)

### Matrix —ç—Ç–æ Synapse?

Matrix —ç—Ç–æ –Ω–µ –ø—Ä–æ–≥—Ä–∞–º–º–∞, —ç—Ç–æ –ø—Ä–æ—Ç–æ–∫–æ–ª, –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª, —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞. –§–∞–∫—Ç–∏—á–µ—Å–∫–∏ —á–∞—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ [Synapse](https://github.com/element-hq/synapse?sl), –Ω–æ –µ—Å—Ç—å –∏ –¥—Ä—É–≥–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä [Dendrite](https://github.com/element-hq/dendrite?sl).

–ü–æ–¥–æ–±–Ω–æ —Ç–æ–º—É –∫–∞–∫ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ IMAP/SMTP, Matrix –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç—ã –∏ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–ª–∂–Ω—ã –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è –¥–∞–Ω–Ω—ã–º–∏. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–∞–º –∏ –∫–ª–∏–µ–Ω—Ç–∞–º —Ä–∞–±–æ—Ç–∞—Ç—å –≤–º–µ—Å—Ç–µ.

### –ß—Ç–æ –±—É–¥–µ–º –¥–µ–ª–∞—Ç—å?

–ó–∞—Ö–æ—Å—Ç–∏–º Matrix –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –Ω–∞ –¥–æ–º–∞—à–Ω–µ–º –ü–ö —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º IP, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ —á–µ—Ä–µ–∑ VPS.

Synapse –¥–æ–≤–æ–ª—å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞—Ç–µ–ª–µ–Ω –∫ –∂–µ–ª–µ–∑—É (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª-–≤–∞ —é–∑–µ—Ä–æ–≤), –æ—Å–æ–±–µ–Ω–Ω–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ (–º–µ–¥–∏–∞ —Ñ–∞–π–ª—ã), –∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π VPS/VDS –±—É–¥–µ—Ç –Ω–µ –¥–µ—à–µ–≤—ã–º. –ü–æ—ç—Ç–æ–º—É —è –ø–æ–∫–∞–∂—É –∫–∞–∫ –ø–æ–¥–Ω—è—Ç—å Matrix –∏–º–µ–Ω–Ω–æ –Ω–∞ –¥–æ–º–∞—à–Ω–µ–º –ü–ö/—Å–µ—Ä–≤–µ—Ä–µ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∑–∞—Ç–æ—á–µ–Ω–Ω–æ–π –ø–æ–¥ Pangolin.

–ß—Ç–æ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è:

- –î–æ–º–∞—à–Ω–∏–π —Å–µ—Ä–≤–µ—Ä, >2 CPU & RAM, –∏ –ø–æ–±–æ–ª—å—à–µ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
- –î–µ—à–µ–≤—ã–π VPS, >=1 CPU & RAM, –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ —Å –∫–∞–Ω–∞–ª–æ–º –ø–æ—à–∏—Ä–µ (>=1 Gbit)
- –î–æ–º–µ–Ω–Ω–æ–µ –∏–º—è

–ù—É –∏ –≤ –∏–¥–µ–∞–ª–µ –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞–Ω–∏—è Linux, Docker, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS –∏ –∑–Ω–∞–Ω–∏–µ Pangolin.

–ü–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç—Å—è —á—Ç–æ –≤—ã —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏, –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ Pangolin –∏ –ø—Ä–æ–≤–µ—Ä–∏–ª–∏ —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –µ—Å–ª–∏ –Ω–µ—Ç:

{{< embedPost url="installing-pangolin" >}}

–í –¥–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç—å–µ —è –ø–æ–∫–∞–∂—É –∫–∞–∫ –ø–æ–¥–Ω—è—Ç—å –∏ Synapse –∏ [Element](https://element.io/?sl). Element –Ω—É–∂–µ–Ω —á—Ç–æ–±—ã –±—ã–ª–∞ –Ω–µ–∫–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (frontend, –∫–ª–∏–µ–Ω—Ç) –≥–¥–µ —é–∑–µ—Ä—ã –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –º–æ–≥–ª–∏ –±—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç –∏/–∏–ª–∏ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç, –∞ —Ç–∞–∫ –∂–µ —á—Ç–æ–±—ã –±—ã–ª–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å [–∫–ª–∏–µ–Ω—Ç–∞–º–∏ Element](https://element.io/app?sl) –∏ –≤ —Ü–µ–ª–æ–º Matrix –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –±–µ–∑ –ø—Ä–æ–≥—Ä–∞–º–º.

–î–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–∞, Synapse –∏ Element. –ò—Ö –º–æ–∂–Ω–æ –ø–æ–≤–µ—Å–∏—Ç—å –Ω–∞ –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö –¥–æ–º–µ–Ω–∞/–ø–æ–¥–¥–æ–º–µ–Ω–∞, –Ω–æ –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã, Element –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –±—É–¥–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –¥–æ–º–µ–Ω—É –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–∞ –Ω–µ–º –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç Synapse, –ø–æ—ç—Ç–æ–º—É –±—É–¥–µ—Ç –∫—É—á–∞ –æ—à–∏–±–æ–∫, *–∏ —É—á–∏—Ç—ã–≤–∞—è —á—Ç–æ –≤ —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è —Ö–æ—Å—Ç–∏–Ω–≥ Synapse –∏ Element –Ω–∞ –æ–¥–Ω–æ–π –º–∞—à–∏–Ω–µ, –º—ã –Ω–µ –±—É–¥–µ—Ç –ø–∞—Ä–∏—Ç—Å—è, –∏ —Å–¥–µ–ª–∞–µ–º –∫–∞–∫ –ø—Ä–æ—â–µ.*

–ß—Ç–æ–±—ã —ç–ª–µ–≥–∞–Ω—Ç–Ω–æ —ç—Ç–æ —Ä–µ—à–∏—Ç—å, –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ç—å –≤–Ω—É—Ç—Ä–∏ Docker, –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Nginx —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å reverse proxy –Ω–∞ localhost, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –±—É–¥–µ—Ç –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Pangolin.

–¢–∏–ø–æ —Ç–∞–∫–æ–≥–æ:

```yaml {linenos=false}
services:
  synapse and etc:
    networks:
      m_network:
        ipv4_address: 10.10.10.X

  reverse-proxy:
    ports:
      - "4100:80"
    networks:
      m_network:
        ipv4_address: 10.10.10.X

networks:
  m_network:
    ipam:
      driver: default
      config:
        - subnet: "10.10.10.0/24"
```

```conf {linenos=false}
# Synapse API
location ~ ^(/_matrix|/_synapse/client) {
    ...
}

# Element
location / {
    ...
}
```

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ–±—â–∞—é—Ç—Å—è –º–µ–∂–¥—É —Å–æ–±–æ–π –≤ —Å–≤–æ–µ–π Docker —Å–µ—Ç–∏, –≤–µ—Å—å –≤–Ω–µ—à–Ω–∏–π —Ç—Ä–∞—Ñ–∏–∫ –≤—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ nginx, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 4100 –ø–æ—Ä—Ç—É –∏ —Ö–æ—Å—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ Pangolin.

{{< callout/hint >}}
–§–∞–∫—Ç–∏—á–µ—Å–∫–∏ –µ—Å–ª–∏ –≤—ã –Ω–µ–º–Ω–æ–≥–æ –≤ —Ç–µ–º–µ, —ç—Ç–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –¥–ª—è —Ö–æ—Å—Ç–∏–Ω–≥–∞ Matrix –ø—Ä—è–º–æ –Ω–∞ VPS, —Ç–∞–∫ –∏ –Ω–∞ –¥–æ–º–∞—à–Ω–µ–º —Å–µ—Ä–≤–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É—è –Ω–∞ VPS –Ω–µ —Ç–æ–ª—å–∫–æ Pangolin, –∞ —á—Ç–æ-–Ω–∏–±—É–¥—å –¥—Ä—É–≥–æ–µ.
{{< /callout/hint >}}

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Matrix

{{< callout/note >}}
Synapse –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç sqlite, (–ª–∏—á–Ω–æ–µ –º–Ω–µ–Ω–∏–µ) —ç—Ç–æ _[—Å–æ–≤—Å–µ–º](https://www.google.com/search?q=why+postgresql+better+than+sqlite?sl)_ –Ω–µ –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–∏–π –≤—ã–±–æ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –ø–æ—ç—Ç–æ–º—É –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PostgreSQL.
{{< /callout/note >}}

{{< callout/hint >}}
–Ø –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ Matrix. –ï—Å–ª–∏ –≤—ã –±—É–¥–µ—Ç–µ —á—Ç–æ-—Ç–æ –º–µ–Ω—è—Ç—å, —á—Ç–æ –Ω–µ –æ–ø–∏—Å–∞–Ω–æ –≤ —Ç–µ–∫—Å—Ç–µ –Ω–∏–∂–µ, –¥–µ–ª–∞–π—Ç–µ —ç—Ç–æ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ.
{{< /callout/note >}}

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker:

```bash
sudo sh -c 'curl -fsSL https://get.docker.com -o get-docker.sh && sh ./get-docker.sh && rm -f get-docker.sh'
```

–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –∫–æ–Ω—Ñ–∏–≥–∞–º–∏:

```bash
git clone https://github.com/nozsh/matrix-element-pangolin-conf matrix && cd matrix
```

–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Synapse (homeserver.yaml):

```bash
sudo docker compose run --rm -e SYNAPSE_SERVER_NAME=domain.org -e SYNAPSE_REPORT_STATS=no synapse generate
```

–ì–¥–µ `domain.org` –≤–∞—à –¥–æ–º–µ–Ω –∏–ª–∏ –ø–æ–¥–¥–æ–º–µ–Ω, –Ω–∞ –Ω–µ–≥–æ –¥–æ–ª–∂–Ω–æ/–±—É–¥–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å DNS –∑–∞–ø–∏—Å—å –Ω–∞ –≤–∞—à VPS —Å–µ—Ä–≤–µ—Ä –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Pangolin.

–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ nano [^nano] :

[^nano]: –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä nano: <kbd>CTRL</kbd> + <kbd>X</kbd>, `y`, `Enter` -- —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤—ã–π—Ç–∏.

```bash
nano synapse/homeserver.yaml
```

–í —Å–∞–º—ã–π –∫–æ–Ω–µ—Ü –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

```yaml
enable_registration: true
enable_registration_without_verification: true
```

- `enable_registration` - –≤–∫–ª—é—á–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é.
- `enable_registration_without_verification` - –æ—Ç–∫–ª—é—á–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –µ—Å–ª–∏ –Ω–µ—Ç—É –Ω–∏–∫–∞–∫–æ–π –∑–∞—â–∏—Ç—ã —Ç–∏–ø–∞ –∫–∞–ø—á–∏.

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```bash
cp example.env .env && nano .env
```

–ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–µ—Ü. —Å–∏–º–≤–æ–ª—ã —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ:

```bash
sudo docker compose config
```

–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `POSTGRES_PASSWORD` –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç—É –∂–µ —Å—Ç—Ä–æ–∫—É —á—Ç–æ –≤—ã —Ç—É–¥–∞ –∏ –ø–æ–ª–æ–∂–∏–ª–∏ (–≤ ".env").

–î–∞–ª—å—à–µ –Ω—É–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞ PostgreSQL. –ò–∑ "homeserver.yaml.example" —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é `database` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ –≤ –≤–∞—à–µ–º "homeserver.yaml":

```yaml
database:
  ...
```

–ù–µ –∑–∞–±—É–¥—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å "password" —Ç–∞–∫–æ–π –∂–µ, –∫–∞–∫–æ–π –≤—ã —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –≤ ".env".

–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞ Element:

```bash
nano element-config.json
```

–í `base_url` –≤–∞—à –¥–æ–º–µ–Ω —Å –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º –∏ –±–µ–∑ "/" –≤ –∫–æ–Ω—Ü–µ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ "https", Pangolin —Å–∞–º —Ä–∞–±–æ—Ç–∞–µ—Ç —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏.

`"disable_custom_urls": true` - –∑–∞–ø—Ä–µ—â–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ù–ï –≤–∞—à Matrix —Å–µ—Ä–≤–µ—Ä, –∏–Ω–∞—á–µ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π Matrix —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ –≤–∞—à Element instance.

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ:

```bash
nano wellknown/matrix/client
```

–ò —Ç–∞–∫ –∂–µ:

```bash
nano nginx/default.conf
```

–ü–æ–º–µ–Ω—è–π—Ç–µ `server_name domain.org` –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω.

–î–∞–ª–µ–µ –Ω—É–∂–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–≤–µ —Å—Ç—Ä–æ–∫–∏ –≤ "docker-compose.yaml":

```bash
nano docker-compose.yaml
```

```yaml
#    depends_on:
#      - synapse_db
        ‚áì
    depends_on:
      - synapse_db
```

{{% details/1 "**–í–ê–ñ–ù–û:** –û PostgreSQL >=18" %}}

–í –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ PostgreSQL –∏–∑–º–µ–Ω–µ–Ω—ã –ø—É—Ç–∏, –ø–æ—ç—Ç–æ–º—É –µ—Å–ª–∏ –≤—ã **–Ω–µ** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –≤–µ—Ä—Å–∏—é <18 —Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Ö –∏–∑–º–µ–Ω–∏—Ç—å –≤ –≤–∞—à–µ–º docker-compose.yaml.

–ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–∞—è (–¥–∞–Ω–Ω—ã—Ö –µ—â–µ –Ω–µ—Ç—É –∏–ª–∏ –µ—Å—Ç—å, –Ω–æ –∏—Ö –Ω–µ –∂–∞–ª–∫–æ), —Ç–æ

```bash
sudo docker compose down -v
```

–î–∞–ª–µ–µ:

```bash
sudo docker exec matrix-1-synapse_db-1 env | grep PGDATA
```

{{< callout/note >}}
–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ `matrix-1-synapse_db-1` –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á–µ—Ä–µ–∑ `sudo docker ps`.
{{< /callout/note >}}

–ù–∞–ø—Ä–∏–º–µ—Ä –≤—ã–≤–µ–ª–æ `PGDATA=/var/lib/postgresql/18/docker`, –∑–Ω–∞—á–∏—Ç –≤ docker-compose.yaml –∏–∑–º–µ–Ω–∏—Ç—å:

```yaml
    volumes:
      - ...:/var/lib/postgresql/data
       ‚áì
    volumes:
      - ...:/var/lib/postgresql/18/docker
```

{{% /details/1 %}}

{{< callout/hint >}}
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–µ—â–∏ –∏–∑ "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ" –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–æ –∑–∞–ø—É—Å–∫–∞.

üöÄ - –ª—É—á—à–µ —Å–¥–µ–ª–∞—Ç—å –¥–æ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞<br>
üß© - –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ –∏–º–µ–µ—Ç
{{< /callout/hint >}}

–ó–∞–ø—É—Å–∫:

```bash
sudo sh -c 'docker compose down && docker compose up -d --force-recreate && docker compose logs -f'
```

Element –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è –ø–æ ip:port (–≤ –∫–æ–Ω—Ñ–∏–≥–µ 4100) –∏ –¥–æ–º–µ–Ω—É –µ—Å–ª–∏ –≤—ã —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ Pangolin.

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

{{< callout/warn >}}
**–≠—Ç–æ –¥–æ–ø. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ª—é–¥–µ–π –∫–æ—Ç–æ—Ä—ã–µ —á–µ–≥–æ-—Ç–æ —Ö–æ—Ç—è—Ç –∏ –ø–æ–Ω–∏–º–∞—é—Ç —á—Ç–æ –∏–º–µ–Ω–Ω–æ –∏ –∫–∞–∫ –∏–º–µ–Ω–Ω–æ —Ö–æ—Ç—è—Ç. –ï—Å–ª–∏ –≤—ã –Ω–µ –∑–Ω–∞–µ—Ç–µ –Ω–∞–¥–æ –ª–∏ –æ–Ω–æ –≤–∞–º, –∏–ª–∏ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç–µ –æ —á–µ–º —Ä–µ—á—å -- –Ω–µ –¥–µ–ª–∞–π—Ç–µ —ç—Ç–æ–≥–æ.**
{{< /callout/warn >}}

{{< callout/warn >}}
"–ö—Ä–∞—Å–∏–≤—ã–µ —é–∑–µ—Ä–Ω–µ–π–º—ã" –∏ "–í–∫–ª—é—á–µ–Ω–∏–µ/–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–µ–¥–µ—Ä–∞—Ü–∏–∏" –≤–µ—Ä–æ—è—Ç–Ω–æ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å —Å Pangolin, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å/–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥–∏ —Ä—É–∫–∞–º–∏. –ê –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏—è —ç—Ç–æ–π —Å—Ç–∞—Ç—å–∏ –≤ Pangolin –Ω–µ–ª—å–∑—è –≤—Ä—É—á–Ω—É—é –º–µ–Ω—è—Ç—å –∫–æ–Ω—Ñ–∏–≥–∏.
{{< /callout/warn >}}

### üöÄ –ö—Ä–∞—Å–∏–≤—ã–µ —é–∑–µ—Ä–Ω–µ–π–º—ã

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø–æ–¥–¥–æ–º–µ–Ω, –∏ –≤–µ–∑–¥–µ —É–∫–∞–∂–∏—Ç–µ –ø–æ–¥–¥–æ–º–µ–Ω "sub.domain.org" (–ø–æ—Ç–æ–º—É —á—Ç–æ —Ç–∞–º —É –≤–∞—Å synapse/element), —Ç–æ —é–∑–µ—Ä–Ω–µ–º—ã –±—É–¥—É—Ç —Ç–∞–∫–∏–º–∏ "user:sub.domain.org". –Ø –ø–æ–∫–∞–∂—É –∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å —á—Ç–æ–±—ã –æ–Ω–∏ –±—ã–ª–∏ —Ç–∞–∫–∏–º–∏ -- "user:domain.org".

–ï—Å–ª–∏ –≤—ã —É–∂–µ –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏, –≤—Å–µ –∑–∞–ø—É—Å—Ç–∏–ª–∏, –∏ –≤—Å–µ —É–∂–µ –¥–∞–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç -- —Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–π—Ç–µ, —á—Ç–æ–±—ã —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å –Ω—É–∂–Ω–æ **–æ—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö**. –ù—É, –∞ –µ—Å–ª–∏ –≤—ã –µ—â–µ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª–∏ —Ç–æ —Å–º–µ–ª–æ –¥–µ–ª–∞–π—Ç–µ. –ê –µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–ª–∏, –Ω–æ —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
sudo docker compose down -v
```

```bash
rm -rf /path/to/location/where/db/*
```

–≠—Ç–æ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ë–î. *–ù—É –∏–ª–∏ –º–æ–∂–µ—Ç–µ –≤—Ä—É—á–Ω—É—é –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏—Ç—å –±–∞–∑—É.*

**–î–æ–º–∞—à–Ω–∏–π —Å–µ—Ä–≤–µ—Ä**

```bash
nano synapse/homeserver.yaml
```

```yaml
server_name: "sub.domain.org" ==> "domain.org"
```

*–í–æ—Ç element-config.json –º–µ–Ω—è—Ç—å —á–∏—Å—Ç–æ –¥–ª—è –æ–±—â–µ–π —ç—Å—Ç–µ—Ç–∏–∫–∏, –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.*

```bash
nano element-config.json
```

```json {hl_lines=[5]}
{
    "default_server_config": {
        "m.homeserver": {
            "base_url": "https://sub.domain.org",
            "server_name": "domain.org"
        }
    },
    "disable_custom_urls": true
}
```

```bash
nano nginx/default.conf
```

–£–±—Ä–∞—Ç—å:

```conf
    location /.well-known/matrix/ {
        root /usr/share/nginx/html;
        default_type application/json;
        add_header Access-Control-Allow-Origin *;
    }
```

**VPS**

–í –∫–æ—Ä–Ω–µ —Å–∞–π—Ç–∞ domain.org:

```bash
mkdir -p .well-known/matrix/ && touch .well-known/matrix/client && touch .well-known/matrix/server && ls .well-known/matrix/
```

client:

```json
{
  "m.homeserver": {
    "base_url": "https://sub.domain.org"
  }
}
```

server:

```json
{
  "m.server": "sub.domain.org:443"
}
```

NGINX –¥–ª—è "domain.org" (**–ù–ï** "sub.domain.org"):

```conf {hl_lines=[4,5,6,7]}
server {
    listen 443 ssl;
...
    location /.well-known/matrix/ {
        default_type application/json;
        add_header Access-Control-Allow-Origin *;
    }

    location / {
...
```

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ñ–µ–¥–µ—Ä–∞—Ü–∏—é, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç [–∑–¥–µ—Å—å](https://federationtester.matrix.org/?sl).

–£ "sub.domain.org" –≤–µ—Ä–æ—è—Ç–Ω–æ –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞ "MatchingServerName", —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –ù–æ —É "domain.org" -- –æ—à–∏–±–æ–∫ –±—ã—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–æ, —Ç–æ –µ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω—É–∂–Ω–æ —Ç–æ —á—Ç–æ —É–∫–∞–∑–∞–Ω–æ –≤ `server_name` –≤ homeserver.yaml.

### üß© –í–∫–ª—é—á–µ–Ω–∏–µ/–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–µ–¥–µ—Ä–∞—Ü–∏–∏

**–î–æ–º–∞—à–Ω–∏–π —Å–µ—Ä–≤–µ—Ä**

docker-compose.yaml:

```yaml
  reverse-proxy:
    ports:
      - "4100:80"
      - "4101:8448"
```

NGINX default.conf:

```conf
...
server {
    listen 80;
    listen [::]:80;
    listen 8448;
    listen [::]:8448;
...
```

**VPS**

–û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç 8448 –≤ firewall –∏ —É–∫–∞–∑–∞—Ç—å –µ–≥–æ –≤ Docker –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Docker, –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ ufw –∏ ZT:

```bash
ufw allow 8448/tcp
```

```yaml {hl_lines=[6]}
  zerotier:
    ports:
      - "9993:9993/udp"
      - "80:80"
      - "443:443"
      - "8448:8448"
```

NGINX, –≤ –∫–æ–Ω—Ü–µ –¥–æ–±–∞–≤–∏—Ç—å –µ—â–µ –æ–¥–∏–Ω server –±–ª–æ–∫:

```conf {hl_lines=[4,8,9,17]}
server {
    listen 8448 ssl;
    http2 on;
    server_name domain.org;

    client_max_body_size 100M;

    ssl_certificate /etc/letsencrypt/live/domain.org/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/domain.org/privkey.pem;

    ssl_session_cache shared:le_nginx_SSL:10m;
    ssl_session_timeout 1440m;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;

    location / {
        proxy_pass http://ip:4101;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;

        proxy_http_version 1.1;
    }
}
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Ñ–µ–¥–µ—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ [–∑–¥–µ—Å—å](https://federationtester.matrix.org/?sl).

### üß© –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Ñ–µ–¥–µ—Ä–∞—Ü–∏–∏

homeserver.yaml:

```yaml
federation_domain_whitelist: []
```

–ò–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å —Ñ–µ–¥–µ—Ä–∞—Ü–∏—é —Å–æ –≤—Å–µ–º–∏, –∫—Ä–æ–º–µ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö:

```yaml
federation_domain_whitelist:
  - server.org
  - server.com
```

*–†–∞–∑–Ω–∏—Ü—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É —ç—Ç–∏–º–∏ –¥–≤—É–º—è –Ω–µ—Ç—É, —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Ä–∞–∑–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, –Ω–æ –µ—Å–ª–∏ –ø–µ—Ä–µ—á–∏—Å–ª—è—Ç—å -- —Ç–∞–∫ –ø—Ä–æ—Å—Ç–æ —É–¥–æ–±–Ω–µ–µ, —á–µ–º –≤ —Å—Ç—Ä–æ–∫—É.*

### üß© –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Google reCaptcha

–°–æ–∑–¥–∞—Ç—å –∫–ª—é—á–∏ [—Ç—É—Ç](https://www.google.com/recaptcha/admin/create?sl) (v2, "I'm not a robot").

homeserver.yaml:

```yaml
enable_registration_without_verification: false

recaptcha_public_key: "x"
recaptcha_private_key: "x"
enable_registration_captcha: true
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, –∫–∞–ø—á–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ –¥–æ–º–µ–Ω–µ. –ü—Ä–∏ –¥–æ—Å—Ç—É–ø–µ —á–µ—Ä–µ–∑ ip:port –∫–∞–ø—á–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ –±—É–¥–µ—Ç –∏ –≤—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.

### üöÄ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

{{< callout/note >}}
–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å —Ñ–∞–π–ª—ã -- –∏—Ö –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–∫–æ–≥–¥–∞ —Ä–∞–∑–º–µ—Ç–∏—Ç–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ) –∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
{{< /callout/note >}}

*–ù–∞ –ø—Ä–∏–º–µ—Ä–µ LVM –¥–∏—Å–∫–æ–≤.*

–ï—Å—Ç—å SSD –∏ HDD, –æ–±–∞ LVM, –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –±—ã–ª –æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–æ–º SSD –¥–∏—Å–∫–∞ –¥–ª—è –ë–î Synapse –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–æ–º HDD –¥–ª—è –º–µ–¥–∏–∞ —Ñ–∞–π–ª–æ–≤, –∞ —Å–∞–º Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–ª –≤ home/root.

–≠—Ç–æ —Ä–∞–±–æ—á–∏–π –ø—Ä–∏–º–µ—Ä, –≥–¥–µ "vg0" –≤–∞—à Volume Group, –≥–¥–µ sda1 –∏ nvme0n1 –≤–∞—à–∏ –¥–∏—Å–∫–∏:

```bash
sudo lvcreate -L 10G -n synapse-1-media vg0 /dev/sda1
sudo mkfs.ext4 /dev/vg0/synapse-1-media
sudo mkdir -p /mnt/synapse-1-media
sudo mount /dev/vg0/synapse-1-media /mnt/synapse-1-media
sudo su
echo "/dev/vg0/synapse-1-media /mnt/synapse-1-media ext4 defaults 0 2" >> /etc/fstab
exit
```

```bash
sudo lvcreate -L 10G -n synapse-1-db vg0 /dev/nvme0n1p3
sudo mkfs.ext4 /dev/vg0/synapse-1-db
sudo mkdir -p /mnt/synapse-1-db
sudo mount /dev/vg0/synapse-1-db /mnt/synapse-1-db
sudo su
echo "/dev/vg0/synapse-1-db /mnt/synapse-1-db ext4 defaults 0 2" >> /etc/fstab
exit
```

```bash
sudo sh -c 'mkdir -p /mnt/synapse-1-media/data && mkdir -p /mnt/synapse-1-db/data'
```

–ü—Ä–∞–≤–∞:

```bash
chown -R 1000:1000 /mnt/synapse-1-media
```

–ü–æ—Ç–æ–º—É —á—Ç–æ docker-compose.yaml:

```yaml
synapse:
  environment:
    - UID=1000
    - GID=1000
```

–ù–∞ "synapse-1-db" —Ç–æ–∂–µ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∏ –≥—Ä—É–ø–ø—É, –µ—Å–ª–∏:

```bash
sudo docker run --rm postgres id
```

–ø–æ–∫–∞–∂–µ—Ç **–Ω–µ**:

```bash
uid=0(root) gid=0(root) groups=0(root)
```

docker-compose.yaml:

```yaml
synapse:
  volumes:
    - ./synapse:/data
    - /mnt/synapse-1-media/data:/media

synapse_db:
  volumes:
    - /mnt/synapse-1-db/data:/var/lib/postgresql/data
```

homeserver.yaml:

```yaml
media_store_path: /media/data
uploads_path: /media/data/uploads
```

–ü—É—Ç—å –ø–æ–ª—É—á–∏—Ç—Å—è "/data/data/", –≤ –∫–æ—Ä–µ–Ω—å —Ñ–∞–π–ª—ã –ª—É—á—à–µ –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å, –ø–æ—Ç–æ–º—É —á—Ç–æ –∫–æ—Ä–µ–Ω—å –∑–∞—á–∞—Å—Ç—É—é –Ω–µ –ø—É—Å—Ç–æ–π –∏–∑-–∑–∞ "lost+found" (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã). –ê –ø—Ä–æ–≥—Ä–∞–º–º–∞ –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å —á—Ç–æ–±—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –±—ã–ª–∞ –ø—É—Å—Ç–∞, —Ç–∞–∫ –Ω–∞–ø—Ä–∏–º–µ—Ä —Ç—Ä–µ–±—É–µ—Ç PostgreSQL, –∫ —Ç–æ–º—É –∂–µ –∑–∞—á–µ–º —Å–º–µ—à–∏–≤–∞—Ç—å —Ñ–∞–π–ª—ã.

_–ù–µ –∫—Ä–∞—Å–∏–≤–æ, –Ω–æ —Ç–æ—á–Ω–æ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å._

### üß© –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤ (Max Upload Size)

homeserver.yaml:

```yaml
max_upload_size: 500M
```

nginx:

```conf
client_max_body_size 500M;
```

### üß© –î—Ä—É–≥–∏–µ —Ä–∞–∑–º–µ—Ä—ã –º–∏–Ω–∏–∞—Ç—é—Ä

–ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –∏–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –≤–æ–≤—Å–µ. –õ–∏—á–Ω–æ —É –º–µ–Ω—è –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ –∏ —Å–ª–æ–º–∞–ª–æ –∞–≤–∞—Ç–∞—Ä–∫–∏.

homeserver.yaml:

```yaml
thumbnail_sizes:
  - width: 320
    height: 240
    method: scale # OR crop
```

–í –ª—é–±–æ–º —Å–ª—É—á–∞–µ –º–∏–Ω–∏–∞—Ç—é—Ä—ã –æ–±—ã—á–Ω–æ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å–∞–º–∏.

[–ü–æ–¥—Ä–æ–±–Ω–µ–µ](https://element-hq.github.io/synapse/latest/usage/configuration/config_documentation.html?#thumbnail_sizes?sl).

### üß© –ú–æ—Å—Ç—ã

#### Telegram

–í —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º docker-compose.yaml:

```yaml
mautrix-telegram:
    image: dock.mau.dev/mautrix/telegram:latest
    container_name: mautrix-telegram
    restart: unless-stopped
    volumes:
      - ./mautrix-telegram:/data
    networks:
      m_network:
        ipv4_address: 10.10.10.6
    depends_on:
      - synapse
```

```bash
mkdir mautrix-telegram
```

```bash
sudo docker compose run --rm mautrix-telegram
```

```bash
sudo nano mautrix-telegram/config.yaml
```

```yaml
address: http://synapse:8008
domain: domain.org
verify_ssl: false
appservice:
    address: http://mautrix-telegram:29317
    database: postgres://synapse:password@synapse_db/mautrix_telegram
#   postgres://username:password@hostname/dbname

...

telegram:
    # Get your own API keys at https://my.telegram.org/apps
    api_id: xyz
    api_hash: xyz

bridge:
    permissions:
        '*': relaybot
        domain.org: puppeting
#        domain.org: full
        '@admin:domain.org': admin
```

```bash
sudo docker compose exec synapse_db psql -U synapse -c "CREATE DATABASE mautrix_telegram WITH ENCODING='UTF8';"
```

```bash
sudo docker compose run --rm mautrix-telegram
```

```bash
cp mautrix-telegram/registration.yaml synapse/mautrix-telegram-registration.yaml
```

```bash
nano synapse/homeserver.yaml
```

```yaml
app_service_config_files:
  - /data/mautrix-telegram-registration.yaml
```

```bash
sudo sh -c 'docker compose down && docker compose up -d --force-recreate && docker compose logs -f'
```

[–ü–æ–¥—Ä–æ–±–Ω–µ–µ](https://docs.mau.fi/bridges/general/docker-setup.html?bridge=telegram?sl).

### üß© –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è SSO

–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ? –ü–æ–º–∏–º–æ –æ–±—â–∏—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–π SSO, —Ç–∞–∫ –∂–µ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ matrix —á–µ—Ä–µ–∑ —Å—Ç–æ—Ä–æ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã —Ç–∏–ø–∞ Google, GitHub –∏ –¥—Ä. (–Ω–æ –æ–± —ç—Ç–æ–º —Ç—É—Ç –Ω–µ –±—É–¥–µ—Ç), –∏/–∏–ª–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∑–∞—â–∏—Ç—ã –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º 2FA. –ü–æ—Ç–æ–º—É —á—Ç–æ synapse/element —Å–∞–º–∏ –ø–æ —Å–µ–±–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç 2FA.

–¢–æ –µ—Å—Ç—å, —á—Ç–æ–±—ã –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç matrix –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –≤–≤–µ—Å—Ç–∏ –ª–æ–≥–∏–Ω, –ø–∞—Ä–æ–ª—å –∏ –∫–ª—é—á –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —Å –¥—Ä—É–≥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –∞ –≤–µ—Å—Ç–∏ –ª–æ–≥–∏–Ω, –ø–∞—Ä–æ–ª—å, 2FA –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–π –∫–ª—é—á** –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –∫–ª—é—á –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è  –∏–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—Ö–æ–¥ —Å –¥—Ä—É–≥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —á—Ç–æ–±—ã —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è.

–°–≤–æ–µ–≥–æ —Ä–æ–¥–∞ ¬´[Defense in Depth](https://1275.ru/glossary/did?nt)¬ª. –ü–æ —Ñ–∞–∫—Ç—É –ø—Ä–æ—Å—Ç–æ –∫—Ä—É—Ç–æ + –º–æ–∂–µ—Ç –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è –µ—Å–ª–∏ —É –≤–∞—Å –±—É–¥–µ—Ç –æ—á–µ–Ω—å –º–Ω–æ–≥–æ selfhosted —Å–µ—Ä–≤–∏—Å–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π SSO, —á—Ç–æ–±—ã –±—ã–ª –æ–¥–∏–Ω –≤—Ö–æ–¥ –Ω–∞ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤–º–µ—Å—Ç–æ –æ–≥—Ä–æ–º–Ω–æ–π –∫—É—á–∏ –ø–∞—Ä –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å.

–ú–æ–∂–Ω–æ –ø–æ–¥–Ω—è—Ç—å –≤ —Ç–æ–º –∂–µ docker-compose.yaml —Ñ–∞–π–ª–µ –≥–¥–µ synapse –∏ element, –∏–ª–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º -- —Ä–∞–∑–Ω–∏—Ü—ã –Ω–µ—Ç. *–ß—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å–µ—Ä–≤–∏—Å–∞ SSO –∏ –∫–∞–∫ —ç—Ç–æ –ø–æ–¥–Ω—è—Ç—å —è –Ω–µ –ø–æ–∫–∞–∂—É, —ç—Ç–æ –≤—ã —Ä–µ—à–∞–π—Ç–µ —Å–∞–º–∏.* –Ø –∂–µ –ø–æ–∫–∞–∂—É —Ç–æ–ª—å–∫–æ –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ [Authentik](https://goauthentik.io/?sl).

{{< callout/note >}}
–ü–æ—Å–ª–µ–¥—É—é—â–∏–µ —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ "SSO" —Ä–∞—Å—Ü–µ–Ω–∏–≤–∞–π—Ç–µ –Ω–µ –∫–∞–∫ –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä—É ¬´Single Sign-On¬ª, –∞ –∫–∞–∫ –Ω–µ–∫—É—é –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É (Authentik, Keycloak, Authelia, Zitadel, –∏ —Ç–¥).
{{< /callout/note >}}

- Applications ==> Providers ==> Create ==> "OAuth2/OpenID Provider". Provider Name - —á—Ç–æ-–Ω–∏–±—É–¥—å —Å–≤—è–∑–∞–Ω–Ω–æ–µ —Å matrix.
- Authorization flow - –Ω–∞ –≤–∞—à –≤–∫—É—Å, –Ω–æ –µ—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—Ç–µ —á—Ç–æ —ç—Ç–æ, –≤—ã–±–∏—Ä–∞–π—Ç–µ "explicit".
- Client type - Confidential.
- Redirect URIs/Origins (RegEx) - —É–∫–∞–∑–∞—Ç—å –≤–∞—à URL Synapse (–≤ —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ –ø–∏—Å–∞–ª–æ—Å—å –ø—Ä–æ Synapse –∏ Element –Ω–∞ –æ–¥–Ω–æ–º –¥–æ–º–µ–Ω–µ –ø–æ—ç—Ç–æ–º—É), –Ω–∞–ø—Ä–∏–º–µ—Ä `https://element.domain.org/_synapse/client/oidc/callback`, –±–µ–∑ `/` –≤ –∫–æ–Ω—Ü–µ. –ü—É—Ç—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ—á–Ω–æ —Ç–∞–∫–∏–º, –∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ.
- Applications ==> Applications ==> Create, –≤–≤–µ—Å—Ç–∏ –∏–º—è –∏ slug, –≤ Provider –≤—ã–±—Ä–∞—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ä–∞–Ω–µ–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä.

–í homeserver.yaml:

```yaml {hl_lines=[1,4,"7-9",13,15]}
public_baseurl: "https://element.domain.org" # url –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º synapse

oidc_providers:
  - idp_id: authentik
    idp_name: "SSO"
    discover: true
    issuer: "https://sso.domain.org/application/o/my-matrix-slug/"
    client_id: "xxx"
    client_secret: "xxx"
    scopes:
      - "openid"
      - "profile"
      # - "email"

    allow_existing_users: true # –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —é–∑–µ—Ä–æ–≤ –æ—Ç–∫–ª—é—á–∏—Ç—å
    enable_registration: true

    user_mapping_provider:
      config:
        localpart_template: "{{ user.preferred_username }}"
        display_name_template: "{{ user.name }}"
```

{{% details/1 "–ú–æ—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è OIDC" %}}
```yaml
oidc_providers:
  - idp_id: authentik
    idp_name: "SSO"
    discover: true
    issuer: "https://sso.domain.org/application/o/matrix-nexus/"
    client_id: "xxx"
    client_secret: "xxx"
    scopes:
      - "openid"
      - "profile"

    allow_existing_users: false
    enable_registration: true

    backchannel_logout_enabled: true # Provider - Logout URI: https://element.domain.org/_synapse/client/oidc/backchannel_logout

    user_mapping_provider:
      config:
        localpart_template: "{{ user.preferred_username }}"
        display_name_template: "{{ user.name }}"
```
{{% /details/1 %}}

NGINX:

```conf
proxy_set_header X-Forwarded-Proto $backend_proto;
                      ‚áì‚áì‚áì
proxy_set_header X-Forwarded-Proto $http_x_forwarded_proto;
```

`allow_existing_users: true` -- –Ω—É–∂–µ–Ω –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ —Ç–µ–∫—É—â–∏—Ö —é–∑–µ—Ä–æ–≤, –µ—Å–ª–∏ —Ç–∞–∫–æ–≤—ã –µ—Å—Ç—å. –î–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —é–∑–µ—Ä–∞ —Å —Ç–µ–º –∂–µ username —á—Ç–æ –∏ –≤ matrix, –µ—Å–ª–∏ "john:domain.org" —Ç–æ "john", –∏ –∫–æ–≥–¥–∞ –î–∂–æ–Ω –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—Å—è, –∫ –∞–∫–∫–∞—É–Ω—Ç—É SSO –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤—è–∂–µ—Ç—Å—è –∞–∫–∫–∞—É–Ω—Ç Synapse.

{{< callout/warn >}}
`allow_existing_users: true` –æ–ø—Ü–∏—è **–û–ß–ï–ù–¨ –ù–ï** –±–µ–∑–æ–ø–∞—Å–Ω–∞—è, –µ—Å–ª–∏ —É –≤–∞—Å –±—É–¥–µ—Ç –≤–∫–ª—é—á–µ–Ω–∞ –ø—É–±–ª–∏—á–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ SSO –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –ª—é–±–æ–π —Å–º–æ–∂–µ—Ç —É–∫—Ä–∞—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç –ø—Ä–æ—Å—Ç–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —é–∑–µ—Ä–Ω–µ–π–º.
{{< /callout/warn >}}

`enable_registration: true` -- –µ—Å–ª–∏ —É –≤–∞—Å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –∏ –≤—ã –¥–µ–ª–∞–µ—Ç–µ –∞–∫–∫–∞—É–Ω—Ç—ã –≤—Ä—É—á–Ω—É—é, —Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç –≤ Synapse –∏ SSO, –Ω–æ –µ—Å–ª–∏ `true`, —Ç–æ —Ç–æ–ª—å–∫–æ –≤ SSO, –∞–∫–∫–∞—É–Ω—Ç Synapse –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –∏ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ SSO –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é "true".

–ß—Ç–æ–±—ã –æ—Ç–∫–ª—é—á–∏—Ç—å –≤—Ö–æ–¥ –ø–æ –ª–æ–≥–∏–Ω—É –∏ –ø–∞—Ä–æ–ª—é, –æ—Å—Ç–∞–≤–∏–≤ —Ç–æ–ª—å–∫–æ SSO, –≤ homeserver.yaml:

```yaml
password_config:
  enabled: false
```

#### –ì—Ä—É–ø–ø—ã (Authentik)

–ì—Ä—É–ø–ø—ã –Ω—É–∂–Ω—ã –µ—Å–ª–∏ –≤—ã –Ω–∞–ø—Ä–∏–º–µ—Ä —Ö–æ—Ç–∏—Ç–µ –∏–º–µ—Ç—å 100 —é–∑–µ—Ä–æ–≤, –Ω–æ —á—Ç–æ –±—ã –ª–∏—à—å 20 –∏–∑ –Ω–∏—Ö –º–æ–≥–ª–∏ –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—Å—è –≤ matrix.

–ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ homeserver.yaml, –∏—Å–∫–∞—Ç—å –ø—Ä–∏–º–µ—Ä `attribute_requirements` [—Ç—É—Ç](https://element-hq.github.io/synapse/latest/usage/configuration/config_documentation.html?sl).

–ù–æ –µ—Å—Ç—å —Ç–∞–∫ –∂–µ –∫–∞–∫ –ø–æ –º–Ω–µ –ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ —á–∏—Å—Ç–æ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Authentik: Applications ==> Applications ==> –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ==> Policy / Group / User Bindings ==> Bind existing Policy / Group / User ==> Group ==> –≤—ã–±—Ä–∞—Ç—å –Ω—É–∂–Ω—É—é —Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω—É—é –≥—Ä—É–ø–ø—É.

#### –ö–∞–ø—á–∞ (Authentik)

–ï—Å–ª–∏ –≤—ã –Ω–µ –∑–∞–¥—É–º–∞–ª–∏—Å—å "–∞ –∫–∞–∫ –∂–µ –∫–∞–ø—á–∞?" -- –∑–∞–¥—É–º–∞–π—Ç–µ—Å—å. –ö–∞–ø—á–∞ –µ—Å—Ç—å –∏ –µ–µ –º–æ–∂–Ω–æ [–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å](https://docs.goauthentik.io/add-secure-apps/flows-stages/stages/captcha/?sl). –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å "stage" –≤ "stages" —Å —Ç–∏–ø–æ–º "Captcha Stage", –≤—ã–±—Ä–∞—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –∏ –≤–ø–∏—Å–∞—Ç—å –∫–ª—é—á–∏, —Ç—É—Ç –≤—Å–µ –ø—Ä–æ—Å—Ç–æ.

–î–∞–ª–µ–µ –∑–∞–π—Ç–∏ –≤ Flows and Stages ==> Flows, –≤—ã–±—Ä–∞—Ç—å –Ω—É–∂–Ω—ã–π Flow –∫—É–¥–∞ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–∞–ø—á—É -- "default-authentication-flow" ==> Stage Bindings ==> Bind existing stage ==> –í—ã–±—Ä–∞—Ç—å —Ç—É –∫–∞–ø—á—É —á—Ç–æ –≤—ã —Å–æ–∑–¥–∞–ª–∏ —Ä–∞–Ω–µ–µ, order –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–µ–∂–¥—É "identification" –∏ "password" -- –æ–±—ã—á–Ω–æ —ç—Ç–æ 15.

### üß© –£—Å—Ç–∞–Ω–æ–≤–∫–∞ TURN —Å–µ—Ä–≤–µ—Ä–∞ (Coturn)

TURN —Å–µ—Ä–≤–µ—Ä –ª—É—á—à–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞ VPS —Å –ø—É–±–ª–∏—á–Ω—ã–º IP, –º–æ–∂–Ω–æ —Ä—è–¥–æ–º —Å Pangolin, –≤—Å–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å. –í Pangolin –¥–ª—è TURN —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∏—á–µ–≥–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.

```bash
git clone https://github.com/nozsh/matrix-element-pangolin-conf coturn && cd coturn && mv extra/coturn . && find . -maxdepth 1 -not -name 'coturn' -not -name '.' -exec rm -rf {} + && mv coturn/* . && rm -rf coturn/
```

–û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç—ã UFW (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π):

```bash
sudo sh -c 'ufw allow 3478/tcp && ufw allow 3478/udp && ufw allow 5349/tcp && ufw allow 5349/udp && ufw allow 59000:60100/udp && ufw status'
```

```bash
nano coturn.conf
```

–ü–æ–º–µ–Ω—è—Ç—å `external-ip`, `realm` –∏ `server-name`. –ê —Ç–∞–∫–∂–µ –¥–∞–Ω–Ω—ã–µ `user=test:test` - –ª–æ–≥–∏–Ω:–ø–∞—Ä–æ–ª—å.

–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ certbot, –∏–ª–∏ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä Cloudflare:

- "cert.pem" - –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
- "private.key" - –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á

```bash
touch certs/cert.pem certs/private.key
```

–ï—Å–ª–∏ –≤—ã —Å–æ–∑–¥–∞–ª–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Å –ø–æ–º–æ—â—å—é "certbot" —Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å "fullchain.pem" –∏ "privkey.pem":

- /etc/letsencrypt/live/turn.domain.org/fullchain.pem
- /etc/letsencrypt/live/turn.domain.org/privkey.pem

```bash
docker compose up -d && docker compose logs -f --tail=200
```

–ï—Å–ª–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –≤—Å–µ –≤–∏—Å–Ω–µ—Ç -- —É–±–µ—Ä–∏—Ç–µ –ø–æ—Ä—Ç—ã –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```yaml {hl_lines=[3]}
services:
  coturn:
    network_mode: host
```

*–ë–æ–ª–µ–µ —Ç–æ–≥–æ, —Ç–∞–∫ –ª—É—á—à–µ —Å–¥–µ–ª–∞—Ç—å –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ Docker –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –≤—Å–µ —ç—Ç–∏ –ø–æ—Ä—Ç—ã —Å 59000 –¥–æ 60100, —ç—Ç–æ –¥–æ–≤–æ–ª—å–Ω–æ –º–Ω–æ–≥–æ, –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–ª–æ—Ö–æ.*

homeserver.yaml:

```yaml
turn_uris:
  - "turns:turn.domain.org:5349?transport=tcp"
  - "turns:turn.domain.org:5349?transport=udp"
  - "turn:turn.domain.org:3478?transport=tcp"
  - "turn:turn.domain.org:3478?transport=udp"

turn_username: "test"
turn_password: "test"
turn_allow_guests: true
```

–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å turn —Å–µ—Ä–≤–µ—Ä –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç matrix –º–æ–∂–Ω–æ [–∑–¥–µ—Å—å](https://webrtc.github.io/samples/src/content/peerconnection/trickle-ice/?sl), –Ω–æ –µ—Å–ª–∏ —É –≤–∞—Å –≤ –±—Ä–∞—É–∑–µ—Ä–µ –æ—Ç–∫–ª—é—á–µ–Ω WebRTC -- –≤—Ä–µ–º–µ–Ω–Ω–æ –≤–∫–ª—é—á–∏—Ç–µ –µ–≥–æ.

### –£–¥–∞–ª–µ–Ω–∏–µ "—Å—Ç–∞—Ä—ã—Ö" –º–µ–¥–∏–∞ —Ñ–∞–π–ª–æ–≤

–≠—Ç–æ –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å:

homeserver.yaml:

```yaml
media_retention:
  local_media_lifetime: 90d   # –º–µ–¥–∏–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  remote_media_lifetime: 14d  # –º–µ–¥–∏–∞ —Å –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ (—Ñ–µ–¥–µ—Ä–∞—Ü–∏—è)
```

100% —Ä–∞–±–æ—á–∏–π –≤–∞—Ä–∏–∞–Ω—Ç —á–µ—Ä–µ–∑ API:

–°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω –∞–∫–∫–∞—É–Ω—Ç -- —Å–º. <a href="#synapse-admin-–∞–¥–º–∏–Ω–∫–∞">Synapse Admin</a>.

–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω:

```bash
URL="http://10.10.10.2:8008"; USER="@admin:domain.org"; PASS='abrakadabra'; curl -X POST "$URL/_matrix/client/v3/login" -H "Content-Type: application/json" -d "{\"type\":\"m.login.password\",\"user\":\"$USER\",\"password\":\"$PASS\"}"
```

–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —á—Ç–æ —Å—Ç–∞—Ä—à–µ 1 –º–∏–Ω—É—Ç—ã (60000 –≤ –º—Å):

```bash
BEFORE_TS=$(($(date +%s%3N) - 60000)); URL="http://10.10.10.2:8008"; TOKEN="token"; curl -X POST -H "Authorization: Bearer $TOKEN" "$URL/_synapse/admin/v1/media/delete?before_ts=$BEFORE_TS"
```

–ò–ª–∏ –≤ –æ–¥–Ω—É –∫–æ–º–∞–Ω–¥—É, –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω, –≤—ã–ø–æ–ª–Ω–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ, –æ—Ç–æ–∑–≤–∞—Ç—å —Ç–æ–∫–µ–Ω:

```bash
URL="http://10.10.10.2:8008"; USER="@admin:domain.org"; PASS='abrakadabra'; DELAFTERMS=60000; LOGIN_RESP=$(curl -s -X POST "$URL/_matrix/client/v3/login" -H "Content-Type: application/json" -d "{\"type\":\"m.login.password\",\"user\":\"$USER\",\"password\":\"$PASS\"}"); echo "Login response: $LOGIN_RESP"; TOKEN=$(echo "$LOGIN_RESP" | grep -oP '"access_token":"\K[^"]+'); BEFORE_TS=$(($(date +%s%3N) - DELAFTERMS)); curl -X POST -H "Authorization: Bearer $TOKEN" "$URL/_synapse/admin/v1/media/delete?before_ts=$BEFORE_TS"; curl -X POST "$URL/_matrix/client/v3/logout" -H "Authorization: Bearer $TOKEN"
```

–ò–ª–∏ [—Å–∫—Ä–∏–ø—Ç–æ–º](https://github.com/nozsh/matrix-element-pangolin-conf/blob/main/utilities/media-cleanup.sh?sl). –ò —Å–¥–µ–ª–∞—Ç—å cron –∑–∞–¥–∞—á—É, —Ç–∏–ø–æ —Ç–∞–∫–æ–≥–æ:

```bash
crontab -e
0 0 1 * * >.../matrix/utilities/media-cleanup.log; bash .../matrix/utilities/media-cleanup.sh >> .../matrix/utilities/media-cleanup.log 2>&1
```

–ë—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∫–∞–∂–¥—ã–µ 30 –¥–Ω–µ–π –≤ 00:00.

{{< callout/note >}}
–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —Å–ø–æ—Å–æ–± —á–µ—Ä–µ–∑ API –Ω–µ —É–¥–∞–ª—è–µ—Ç –∞–≤–∞—Ç–∞—Ä–∫–∏, —Ç–æ–ª—å–∫–æ –ª—é–±–æ–π –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –≤ —á–∞—Ç–∞—Ö - —Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ, –∞—Ä—Ö–∏–≤—ã –∏ –ø—Ä–æ—á–∏–µ —Ñ–∞–π–ª—ã.
{{< /callout/note >}}

### Synapse Admin (–∞–¥–º–∏–Ω–∫–∞)

–ê–¥–º–∏–Ω–∫—É –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –≥–¥–µ —É–≥–æ–¥–Ω–æ, –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—Ç—å –≤ Pangolin, –±–æ–ª–µ–µ —Ç–æ–≥–æ, –ª–∏—á–Ω–æ —è –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é —ç—Ç–æ–≥–æ –¥–µ–ª–∞—Ç—å –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–∏ —ç—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∏–∑ —ç—Ç–æ–π —Å—Ç–∞—Ç—å–∏ (–∏–∑-–∑–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx)).

–ê–¥–º–∏–Ω–∫–∞ –æ—Ç [Awesome-Technologies](https://github.com/Awesome-Technologies/synapse-admin?sl):

```yaml
services:
  synapse-admin:
    container_name: synapse-admin
    hostname: synapse-admin
    image: awesometechnologies/synapse-admin:latest
    ports:
      - "4200:80"
    restart: unless-stopped
```

–ê–¥–º–∏–Ω–∫–∞ –æ—Ç [etkecc](https://github.com/etkecc/synapse-admin/?sl):

```yaml
image: ghcr.io/etkecc/synapse-admin:latest
```

–°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω –∞–∫–∫–∞—É–Ω—Ç:

```bash
sudo docker exec matrix-synapse-1 register_new_matrix_user -u admin -p 'abrakadabra' -a -c /data/homeserver.yaml http://localhost:8008
```

SSH —Ç—É–Ω–Ω–µ–ª—å:

```bash
ssh -p 22 -N -L 127.0.0.1:8008:10.10.10.2:8008 user@ip
```

"10.10.10.2" ip Synapse:

```yaml
synapse:
  networks:
    m_network:
      ipv4_address: 10.10.10.2
```

–ü–æ—Ä—Ç 8008 - —ç—Ç–æ –ø–æ—Ä—Ç Synapse –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
